<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DiceTales Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #1a1a1a;
            color: #f0f0f0;
        }
        .debug-info {
            background: #2d2d2d;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .error { color: #f44336; }
        .success { color: #4CAF50; }
        .warning { color: #FF9800; }
    </style>
</head>
<body>
    <h1>üé≤ DiceTales System Debug</h1>
    
    <div class="debug-info">
        <h2>Loading Status</h2>
        <div id="loading-status">Loading JavaScript files...</div>
    </div>
    
    <div class="debug-info">
        <h2>System Checks</h2>
        <div id="system-checks">Running checks...</div>
    </div>
    
    <div class="debug-info">
        <h2>Console Errors</h2>
        <div id="console-errors">Monitoring for errors...</div>
    </div>
    
    <div class="debug-info">
        <h2>Quick Actions</h2>
        <button onclick="testCharacterCreation()" style="margin: 10px; padding: 10px 20px;">Test Character Creation</button>
        <button onclick="testDiceRoll()" style="margin: 10px; padding: 10px 20px;">Test Dice Roll</button>
        <button onclick="clearStorage()" style="margin: 10px; padding: 10px 20px;">Clear Storage</button>
        <button onclick="manualCharacterCreation()" style="margin: 10px; padding: 10px 20px;">Manual Character Creation</button>
        <button onclick="checkCharacterScreen()" style="margin: 10px; padding: 10px 20px;">Check Character Screen</button>
    </div>

    <!-- Load JavaScript files -->
    <script src="js/utils.js"></script>
    <script src="js/gameState.js"></script>
    <script src="js/character.js"></script>
    <script src="js/dice.js"></script>
    <script src="js/ai.js"></script>
    <script src="js/audio.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/main.js"></script>
    
    <script>
        // Capture console errors
        const originalError = console.error;
        const errors = [];
        console.error = function(...args) {
            errors.push(args.join(' '));
            updateErrorDisplay();
            originalError.apply(console, args);
        };
        
        function updateErrorDisplay() {
            const errorDiv = document.getElementById('console-errors');
            if (errors.length === 0) {
                errorDiv.innerHTML = '<span class="success">No errors detected</span>';
            } else {
                errorDiv.innerHTML = '<span class="error">Errors found:</span><br>' + 
                    errors.map(err => `<div class="error">‚Ä¢ ${err}</div>`).join('');
            }
        }
        
        // Wait for DOM and check systems
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(checkSystems, 1000);
        });
        
        function checkSystems() {
            const statusDiv = document.getElementById('loading-status');
            const checksDiv = document.getElementById('system-checks');
            
            statusDiv.innerHTML = '<span class="success">JavaScript files loaded</span>';
            
            const checks = [
                { name: 'Utils (logger)', test: () => typeof logger !== 'undefined' },
                { name: 'Utils (eventBus)', test: () => typeof eventBus !== 'undefined' },
                { name: 'GameState', test: () => typeof gameState !== 'undefined' },
                { name: 'CharacterManager', test: () => typeof characterManager !== 'undefined' },
                { name: 'DiceSystem', test: () => typeof diceSystem !== 'undefined' },
                { name: 'AIManager', test: () => typeof aiManager !== 'undefined' },
                { name: 'AudioManager', test: () => typeof audioManager !== 'undefined' },
                { name: 'UIManager', test: () => typeof uiManager !== 'undefined' },
                { name: 'Main App', test: () => typeof app !== 'undefined' },
                { name: 'createElement', test: () => typeof createElement === 'function' },
                { name: 'showToast', test: () => typeof showToast === 'function' }
            ];
            
            let html = '';
            let passCount = 0;
            
            checks.forEach(check => {
                try {
                    const passed = check.test();
                    const status = passed ? 'success' : 'error';
                    const icon = passed ? '‚úÖ' : '‚ùå';
                    html += `<div class="${status}">${icon} ${check.name}</div>`;
                    if (passed) passCount++;
                } catch (e) {
                    html += `<div class="error">‚ùå ${check.name} (Error: ${e.message})</div>`;
                }
            });
            
            html += `<br><strong>Status: ${passCount}/${checks.length} systems ready</strong>`;
            checksDiv.innerHTML = html;
            
            // If everything is loaded, try to show why the main page might be empty
            if (passCount === checks.length) {
                setTimeout(diagnosePage, 1000);
            }
        }
        
        function diagnosePage() {
            const checksDiv = document.getElementById('system-checks');
            const currentHtml = checksDiv.innerHTML;
            
            // Check loading screen status
            const loadingScreen = parent.document?.getElementById('loading-screen') || 
                                 document.getElementById('loading-screen');
            
            let diagnostic = '<br><br><strong>Page Diagnostic:</strong><br>';
            
            if (loadingScreen) {
                const isActive = loadingScreen.classList.contains('active');
                const display = loadingScreen.style.display;
                diagnostic += `Loading screen: Active=${isActive}, Display=${display || 'default'}<br>`;
            } else {
                diagnostic += 'Loading screen: Not found<br>';
            }
            
            // Check if app initialized
            if (typeof app !== 'undefined' && app.initialized) {
                diagnostic += `<span class="success">App initialized: ${app.initialized}</span><br>`;
                diagnostic += `Current screen: ${app.currentScreen}<br>`;
            } else {
                diagnostic += `<span class="error">App not initialized</span><br>`;
            }
            
            checksDiv.innerHTML = currentHtml + diagnostic;
        }
        
        function testCharacterCreation() {
            if (typeof app !== 'undefined' && app.showCharacterCreation) {
                app.showCharacterCreation();
                alert('Character creation triggered - check main window');
            } else {
                alert('Character creation not available');
            }
        }
        
        function testDiceRoll() {
            if (typeof diceSystem !== 'undefined') {
                diceSystem.selectedDice = ['d20'];
                diceSystem.rollDice();
                alert('Dice roll triggered');
            } else {
                alert('Dice system not available');
            }
        }
        
        function clearStorage() {
            localStorage.clear();
            sessionStorage.clear();
            alert('Storage cleared - refresh the page');
        }
        
        function manualCharacterCreation() {
            if (typeof characterManager !== 'undefined') {
                console.log('Manually triggering character creation...');
                characterManager.showCharacterCreation();
                alert('Character creation triggered - check console for logs');
            } else {
                alert('Character manager not available');
            }
        }
        
        function checkCharacterScreen() {
            const characterScreen = document.getElementById('character-creation');
            const creationContent = document.getElementById('creation-content');
            
            let info = 'Character Screen Check:\n';
            info += `- Character screen exists: ${!!characterScreen}\n`;
            info += `- Character screen display: ${characterScreen?.style.display || 'default'}\n`;
            info += `- Creation content exists: ${!!creationContent}\n`;
            info += `- Creation content innerHTML length: ${creationContent?.innerHTML.length || 0}\n`;
            
            if (creationContent && creationContent.innerHTML.length > 0) {
                info += `- Content preview: ${creationContent.innerHTML.substring(0, 100)}...\n`;
            }
            
            alert(info);
            console.log('Character screen check:', {
                characterScreen,
                creationContent,
                characterScreenDisplay: characterScreen?.style.display,
                contentLength: creationContent?.innerHTML.length,
                contentPreview: creationContent?.innerHTML.substring(0, 200)
            });
        }
    </script>
</body>
</html>
