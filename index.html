<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DiceTales - Adventure Game</title>
    <meta name="description" content="An AI-powered adventure game with dynamic storytelling and immersive gameplay">
    <!-- Local config override (optional) -->
    <script src="js/config.local.js" onerror="console.log('Local config not found - using default config')"></script>
    <script src="js/utils.js"></script>
    <script src="js/gameState.js"></script>
    <script src="js/character.js"></script>
    <script src="js/dice.js"></script>
    <script src="js/dmEvaluator.js"></script>
    <script src="js/ai.js"></script>
    <script src="js/audio.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/main.js"></script>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/character.css">
    <link rel="stylesheet" href="css/dice.css">
    <link rel="stylesheet" href="css/evaluation.css">
    <link rel="stylesheet" href="css/responsive.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🎲</text></svg>">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen active">
        <div class="loading-content">
            <div class="loading-dice">🎲</div>
            <h1>DiceTales</h1>
            <p class="loading-subtitle">Where Epic Adventures Begin</p>
            <p class="loading-status">Preparing your adventure...</p>
            <div class="loading-bar">
                <div class="loading-progress"></div>
            </div>
            <div class="loading-tips">
                <p class="loading-tip">✨ Every roll tells a story</p>
            </div>
        </div>
        <div class="loading-particles">
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
        </div>
    </div>

    <!-- Main Application Container -->
    <div id="app" class="app">
        <!-- Navigation Header -->
        <header class="app-header">
            <div class="header-content">
                <h1 class="app-title">
                    <span class="dice-icon">🎲</span>
                    DiceTales
                </h1>
                <nav class="header-nav">
                    <button id="settings-btn" class="nav-btn" title="Settings">
                        <span class="icon">⚙️</span>
                    </button>
                    <button id="character-sheet-btn" class="nav-btn" title="Character Sheet">
                        <span class="icon">📋</span>
                    </button>
                    <button id="campaign-log-btn" class="nav-btn" title="Campaign Log">
                        <span class="icon">📜</span>
                    </button>
                    <button id="dm-evaluation-btn" class="nav-btn" title="DM Quality Metrics">
                        <span class="icon">📊</span>
                    </button>
                    <button id="save-game-btn" class="nav-btn" title="Save Game">
                        <span class="icon">💾</span>
                    </button>
                    <button id="import-export-btn" class="nav-btn" title="Import/Export Campaign">
                        <span class="icon">📂</span>
                    </button>
                </nav>
            </div>
        </header>

        <!-- Character Creation Screen -->
        <main class="screen character-creation-screen" id="character-creation" style="display: none;">
            <div class="creation-container">
                <div class="creation-header">
                    <h1>Create Your Character</h1>
                    <p>Begin your adventure by crafting your hero</p>
                </div>
                
                <!-- Step Indicator -->
                <div class="step-indicator" id="step-indicator">
                    <!-- Step indicators will be populated by JS -->
                </div>
                
                <div class="creation-content" id="creation-content">
                    <!-- Character creation form will be populated by JS -->
                </div>
                
                <!-- Navigation Buttons -->
                <div class="creation-navigation" id="creation-navigation">
                    <button id="prev-step-btn" class="btn btn-secondary" style="display: none;">
                        ← Previous
                    </button>
                    <button id="next-step-btn" class="btn btn-primary">
                        Next →
                    </button>
                    <button id="complete-creation-btn" class="btn btn-success" style="display: none;">
                        Create Character
                    </button>
                </div>
            </div>
        </main>

        <!-- Campaign Selection Screen -->
        <main class="screen campaign-selection-screen" id="campaign-selection" style="display: none;">
            <div class="campaign-container">
                <div class="campaign-header">
                    <h1>Choose Your Adventure</h1>
                    <p>Select a campaign setting for your tale</p>
                </div>
                <div class="campaign-content" id="campaign-selection-content">
                    <!-- Campaign options will be populated by JS -->
                </div>
            </div>
        </main>

        <!-- Main Game Screen -->
        <main class="screen game-screen" id="game-screen" style="display: none;">
            <!-- Story Display Area -->
            <section class="story-section">
                <div class="story-display" id="story-display">
                    <div class="story-content" id="story-content">
                        <div class="story-waiting" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                            <div style="font-size: 4rem; margin-bottom: 20px; opacity: 0.4;">📖</div>
                            <h3 style="margin-bottom: 15px; color: var(--text-primary);">Your Adventure Awaits</h3>
                            <p style="margin-bottom: 25px; font-size: 1.1rem; opacity: 0.8;">Create your character to begin your epic tale</p>
                            <p style="font-size: 0.9rem; opacity: 0.6;">📜 Stories will unfold here as you make choices and shape your destiny</p>
                            

                        </div>
                    </div>
                </div>
            </section>

            <!-- Game Controls -->
            <section class="controls-section">
                <!-- Dice Rolling Area -->
                <div class="dice-container" id="dice-container">
                    <div class="dice-display" id="dice-display">
                        <div class="dice-waiting" style="text-align: center; padding: 20px; color: var(--text-secondary);">
                            <div style="font-size: 3rem; margin-bottom: 10px; opacity: 0.6;">🎲</div>
                            <p style="margin-bottom: 15px; font-size: 1.1rem;">Action History</p>
                            <p style="margin-bottom: 20px; font-size: 0.9rem; opacity: 0.8;">Recent dice rolls and outcomes will appear here</p>
                            <div style="margin-top: 15px; font-size: 0.8rem; opacity: 0.6;">
                                💡 Tip: Roll your dice in the input section below before submitting actions!
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Free Input -->
                <div class="input-section">
                    <div class="input-container">
                        <textarea 
                            id="player-input" 
                            class="player-input" 
                            placeholder="Describe what you want to do..."
                            rows="3"
                        ></textarea>
                        
                        <!-- Dice Selection and Roll -->
                        <div class="dice-input-section" style="margin: 15px 0; padding: 15px; background: var(--surface-secondary); border-radius: 8px; border: 2px solid var(--border-color);">
                            <label style="display: block; font-weight: bold; margin-bottom: 10px; color: var(--text-primary);">🎲 Choose your dice and roll:</label>
                            <div class="dice-selection" style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                                <button class="dice-btn" data-dice="d4" style="padding: 8px 12px; background: var(--accent-primary); color: white; border: none; border-radius: 4px; cursor: pointer;">D4</button>
                                <button class="dice-btn" data-dice="d6" style="padding: 8px 12px; background: var(--accent-primary); color: white; border: none; border-radius: 4px; cursor: pointer;">D6</button>
                                <button class="dice-btn" data-dice="d8" style="padding: 8px 12px; background: var(--accent-primary); color: white; border: none; border-radius: 4px; cursor: pointer;">D8</button>
                                <button class="dice-btn" data-dice="d10" style="padding: 8px 12px; background: var(--accent-primary); color: white; border: none; border-radius: 4px; cursor: pointer;">D10</button>
                                <button class="dice-btn" data-dice="d12" style="padding: 8px 12px; background: var(--accent-primary); color: white; border: none; border-radius: 4px; cursor: pointer;">D12</button>
                                <button class="dice-btn" data-dice="d20" style="padding: 8px 12px; background: var(--accent-primary); color: white; border: none; border-radius: 4px; cursor: pointer;">D20</button>
                            </div>
                            <div class="dice-result-display" id="input-dice-result" style="min-height: 40px; padding: 10px; background: var(--background-dark); border-radius: 4px; border: 1px solid var(--border-color); text-align: center; color: var(--text-secondary);">
                                Select a die and roll to see your result
                            </div>
                        </div>
                        
                        <button id="submit-action-btn" class="btn btn-primary submit-btn">
                            Submit Action & Roll
                        </button>
                    </div>
                </div>
            </section>

            <!-- Character Status Panel -->
            <aside class="character-status" id="character-status">
                <div class="status-header">
                    <h3 id="character-name">Character</h3>
                    <span id="character-level" class="level-badge">Level 1</span>
                </div>
                <div class="health-bar">
                    <div class="health-label">Health</div>
                    <div class="health-display">
                        <div class="health-bar-container">
                            <div class="health-bar-fill" id="health-bar-fill"></div>
                        </div>
                        <span class="health-text" id="health-text">100/100</span>
                    </div>
                </div>
                <div class="stats-summary" id="stats-summary">
                    <!-- Quick stats display -->
                </div>
                <button id="quick-inventory-btn" class="btn btn-secondary">
                    View Inventory
                </button>
            </aside>
        </main>

        <!-- Modals and Overlays -->
        <!-- Settings Modal -->
        <div class="modal" id="settings-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Settings</h2>
                    <button class="modal-close" data-modal="settings-modal">&times;</button>
                </div>
                <div class="modal-body" id="settings-content">
                    <!-- Settings form will be populated by JS -->
                </div>
            </div>
        </div>

        <!-- Character Sheet Modal -->
        <div class="modal" id="character-sheet-modal">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2>Character Sheet</h2>
                    <button class="modal-close" data-modal="character-sheet-modal">&times;</button>
                </div>
                <div class="modal-body" id="character-sheet-content">
                    <!-- Character sheet will be populated by JS -->
                </div>
            </div>
        </div>

        <!-- Campaign Log Modal -->
        <div class="modal" id="campaign-log-modal">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2>Campaign Log</h2>
                    <button class="modal-close" data-modal="campaign-log-modal">&times;</button>
                </div>
                <div class="modal-body" id="campaign-log-content">
                    <!-- Campaign log will be populated by JS -->
                </div>
            </div>
        </div>

        <!-- DM Evaluation Modal -->
        <div class="modal" id="dm-evaluation-modal">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2>🎭 Game Master Quality Metrics</h2>
                    <button class="modal-close" data-modal="dm-evaluation-modal">&times;</button>
                </div>
                <div class="modal-body" id="dm-evaluation-content">
                    <div class="evaluation-controls">
                        <div class="evaluation-toggle">
                            <label class="toggle-switch">
                                <input type="checkbox" id="enable-evaluation" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <span class="toggle-label">Enable AI Evaluation</span>
                        </div>
                        <div class="evaluation-toggle">
                            <label class="toggle-switch">
                                <input type="checkbox" id="auto-improve" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <span class="toggle-label">Auto-Improve Responses</span>
                        </div>
                    </div>
                    
                    <div class="evaluation-stats" id="evaluation-stats">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="overall-score">-</div>
                                <div class="stat-label">Overall Score</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="total-evaluations">-</div>
                                <div class="stat-label">Total Responses</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="improvement-rate">-</div>
                                <div class="stat-label">Improvement Rate</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="evaluation-categories" id="evaluation-categories">
                        <!-- Category scores will be populated by JS -->
                    </div>
                    
                    <div class="recent-evaluations" id="recent-evaluations">
                        <h3>Recent Response Evaluations</h3>
                        <div class="evaluations-list" id="evaluations-list">
                            <!-- Recent evaluations will be populated by JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Inventory Modal -->
        <div class="modal" id="inventory-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Inventory</h2>
                    <button class="modal-close" data-modal="inventory-modal">&times;</button>
                </div>
                <div class="modal-body" id="inventory-content">
                    <!-- Inventory will be populated by JS -->
                </div>
            </div>
        </div>

        <!-- Import/Export Modal -->
        <div class="modal" id="import-export-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>📂 Import/Export Campaign</h2>
                    <button class="modal-close" data-modal="import-export-modal">&times;</button>
                </div>
                <div class="modal-body" id="import-export-content">
                    <div class="import-export-container">
                        <!-- Export Section -->
                        <div class="export-section">
                            <h3>🎁 Export Campaign</h3>
                            <p>Save your current campaign progress to a file that you can share or backup.</p>
                            <div class="export-info">
                                <div class="info-grid">
                                    <div class="info-item">
                                        <span class="info-label">Character:</span>
                                        <span class="info-value" id="export-character-name">-</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Level:</span>
                                        <span class="info-value" id="export-character-level">-</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Campaign:</span>
                                        <span class="info-value" id="export-campaign-setting">-</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Last Played:</span>
                                        <span class="info-value" id="export-last-played">-</span>
                                    </div>
                                </div>
                            </div>
                            <button id="export-campaign-btn" class="btn btn-primary">
                                📤 Export Campaign
                            </button>
                        </div>

                        <div class="divider"></div>

                        <!-- Import Section -->
                        <div class="import-section">
                            <h3>📥 Import Campaign</h3>
                            <p>Load a previously exported campaign file to continue your adventure.</p>
                            <div class="import-controls">
                                <div class="file-input-wrapper">
                                    <input type="file" id="import-file-input" accept=".json,.dicetales" style="display: none;">
                                    <button id="select-import-file-btn" class="btn btn-secondary">
                                        📁 Select Campaign File
                                    </button>
                                    <span id="selected-file-name" class="selected-file"></span>
                                </div>
                                <div class="import-preview" id="import-preview" style="display: none;">
                                    <h4>Campaign Preview:</h4>
                                    <div class="preview-info">
                                        <div class="info-grid">
                                            <div class="info-item">
                                                <span class="info-label">Character:</span>
                                                <span class="info-value" id="preview-character-name">-</span>
                                            </div>
                                            <div class="info-item">
                                                <span class="info-label">Level:</span>
                                                <span class="info-value" id="preview-character-level">-</span>
                                            </div>
                                            <div class="info-item">
                                                <span class="info-label">Campaign:</span>
                                                <span class="info-value" id="preview-campaign-setting">-</span>
                                            </div>
                                            <div class="info-item">
                                                <span class="info-label">Exported:</span>
                                                <span class="info-value" id="preview-exported-date">-</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="import-warning">
                                        <p>⚠️ <strong>Warning:</strong> Importing will replace your current campaign progress. Make sure to export your current campaign first if you want to keep it!</p>
                                    </div>
                                </div>
                                <button id="import-campaign-btn" class="btn btn-success" style="display: none;">
                                    📥 Import Campaign
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Files -->
    <script src="js/config.js"></script>
    <!-- Optional local config (git-ignored, for development) -->
    <script src="js/config.local.js" onerror="console.log('Local config not found - using default config')"></script>
    <script src="js/utils.js"></script>
    <script src="js/gameState.js"></script>
    <script src="js/character.js"></script>
    <script src="js/dice.js"></script>
    <script src="js/ai.js"></script>
    <script src="js/audio.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/evaluationUI.js"></script>
    <script src="js/main.js"></script>
    
</body>
</html>
